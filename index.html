<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>lev4e</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    @keyframes fall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }

    .falling-note {
      position: absolute;
      animation: fall 2s linear forwards;
      z-index: 10;
      width: 100px;
      height: auto;
      pointer-events: none;
    }

    .thinking-image {
      position: absolute;
      top: 30%;
      left: 50%;
      width: 150px;
      height: auto;
      transform: translate(-50%, -50%);
      z-index: 20;
    }

    .glow-on-hover {
      transition: all 0.3s ease;
    }

    .glow-on-hover:hover {
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
      transform: translateY(-2px);
    }

    .glow-on-hover:active {
      transform: translateY(1px);
    }

    body {
      overflow: hidden;
      background-color: #0f172a;
      color: #f8fafc;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(30, 41, 59, 0.8) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(30, 41, 59, 0.8) 0%, transparent 20%),
        linear-gradient(to bottom, transparent 95%, rgba(148, 163, 184, 0.05) 95%);
      background-size: 200% 200%, 200% 200%, 100% 20px;
    }

    .grid-pattern {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        linear-gradient(rgba(148, 163, 184, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(148, 163, 184, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      z-index: -1;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center font-mono">
  <div class="grid-pattern"></div>

  <div class="text-center mb-8">
    <h1 class="text-5xl font-bold mb-2 tracking-tighter">lev4e</h1>
  </div>

  <button
    id="generateBtn"
    class="glow-on-hover bg-gradient-to-r from-purple-600 to-blue-500 text-white font-bold py-4 px-8 rounded-full text-xl shadow-lg hover:shadow-xl transition-all duration-300"
  >
    dai 5lv
  </button>

  <div id="notesContainer"></div>

  <footer class="absolute bottom-4 text-gray-500 text-sm">
    ¬© 2025 lev4e
  </footer>

  <script>
    const tokenAddress = '0x1DB8096DEC8B0e30eA4435d38960d7f3B644923b'; // üîÅ Replace this with your real deployed contract address
    const tokenAbi = [
      "function claim() public"
    ];

    function showFallingNote() {
      const note = document.createElement('img');
      note.src = '5bgn.jpeg';
      note.className = 'falling-note';
      const randomLeft = Math.random() * (window.innerWidth - 150);
      note.style.left = `${randomLeft}px`;
      const sizeVariation = 0.8 + Math.random() * 0.4;
      note.style.transform = `scale(${sizeVariation})`;
      document.getElementById('notesContainer').appendChild(note);
      setTimeout(() => note.remove(), 2000);
    }

    function showThinkingImage() {
      const thinking = document.createElement('img');
      thinking.src = 'thinking.jpeg';
      thinking.className = 'thinking-image';
      thinking.id = 'thinking-image';
      document.body.appendChild(thinking);
    }

    function removeThinkingImage() {
      const img = document.getElementById('thinking-image');
      if (img) img.remove();
    }

    document.getElementById('generateBtn').addEventListener('click', async function () {
      showThinkingImage();
      document.body.style.cursor = 'wait';

      try {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        const signer = provider.getSigner();
        const contract = new ethers.Contract(tokenAddress, tokenAbi, signer);

        const tx = await contract.claim();
        await tx.wait();

        removeThinkingImage();
        document.body.style.cursor = 'default';

        // üéâ Drop 20 notes in random positions over 2 seconds
        for (let i = 0; i < 20; i++) {
          setTimeout(() => showFallingNote(), Math.random() * 2000);
        }

        // üß† Add token to MetaMask (only once per device)
        if (!localStorage.getItem('5lv-added')) {
          await window.ethereum.request({
            method: 'wallet_watchAsset',
            params: {
              type: 'ERC20',
              options: {
                address: tokenAddress,
                symbol: '5LV',
                decimals: 18,
                image: 'https://markovaxn.github.io/lev4e-dapp/5bgnicon.jpeg'
              },
            },
          }).then((added) => {
            if (added) {
              localStorage.setItem('5lv-added', 'true');
            }
          }).catch((err) => {
            console.warn("Token add rejected", err);
          });
        }

      } catch (err) {
        console.error(err);
        removeThinkingImage();
        document.body.style.cursor = 'default';
        alert("‚ö†Ô∏è Failed to claim 5LV. Check connection and contract.");
      }
    });
  </script>
</body>
</html>
